<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Iron Vault</title>
    <meta name="theme-color" content="#0a0a0a">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --bg: #0a0a0a; --card: #141414; --primary: #00ff88; --text: #ffffff; --dim: #888888; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        /* LAYOUT */
        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; overflow-y: auto; padding-bottom: 50px; }
        .active { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* COMPONENTS */
        h2, h3 { margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #222; }
        .card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid #222; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        /* BUTTONS */
        .btn { background: var(--card); color: var(--text); border: 1px solid #333; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn:active { transform: scale(0.98); background: #222; }
        .btn-primary { background: var(--primary); color: #000; border: none; font-size: 16px; padding: 18px; margin-top: 10px; }
        .btn-icon { font-size: 24px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        /* INPUTS */
        input { background: #222; border: 1px solid #333; color: white; padding: 15px; border-radius: 8px; width: 100%; font-size: 16px; margin-bottom: 10px; }
        input:focus { outline: none; border-color: var(--primary); }
        
        /* UTILS */
        .section-title { margin-top: 25px; margin-bottom: 8px; color: var(--primary); font-weight: bold; font-size: 14px; }
        .nav-icon { font-size: 24px; cursor: pointer; padding: 10px; }
    </style>
</head>
<body>

    <div id="home" class="screen active">
        <div class="header">
            <h3>Iron Vault</h3>
            <div><span class="nav-icon" onclick="nav('guide')">üìñ</span><span class="nav-icon" onclick="nav('tools')">üßÆ</span></div>
        </div>

        <div class="card" style="border-left: 4px solid var(--primary);">
            <div style="font-size: 12px; color: var(--dim);">WELCOME BACK</div>
            <h2 style="margin-top: 5px;">READY TO LIFT?</h2>
        </div>

        <div class="section-title">PHAT SYSTEM (SHUFFLED)</div>
        <div class="grid">
            <button class="btn" onclick="start('Upper Power')"><span class="btn-icon">üí™</span> UPPER POWER</button>
            <button class="btn" onclick="start('Lower Power')"><span class="btn-icon">ü¶µ</span> LOWER POWER</button>
        </div>
        <div class="grid-3">
            <button class="btn" onclick="start('Push Hyper')">PUSH</button>
            <button class="btn" onclick="start('Pull Hyper')">PULL</button>
            <button class="btn" onclick="start('Legs Hyper')">LEGS</button>
        </div>

        <div class="section-title" style="color: orange;">SPECIALTY SPLITS</div>
        <div class="grid-3">
            <button class="btn" onclick="start('Bicep Blaster')">BICEPS</button>
            <button class="btn" onclick="start('Tricep Torture')">TRICEPS</button>
            <button class="btn" onclick="start('Chest Focus')">CHEST</button>
            <button class="btn" onclick="start('Back Focus')">BACK</button>
            <button class="btn" onclick="start('Shoulder Focus')">DELTS</button>
            <button class="btn" onclick="start('Leg Focus')">LEGS</button>
        </div>

        <div class="section-title" style="color: cyan;">CONDITIONING</div>
        <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn" onclick="start('HIIT')">HIIT</button>
            <button class="btn" onclick="start('Animal Flow')">ANIMAL FLOW</button>
            <button class="btn" onclick="start('Tabata')">TABATA</button>
            <button class="btn" onclick="start('EMOM')">EMOM</button>
        </div>

        <div class="section-title" style="color: violet;">RECOVERY</div>
        <div class="grid-3">
            <button class="btn" onclick="start('Desk Undo')">DESK</button>
            <button class="btn" onclick="start('Squat Primer')">PRIMER</button>
            <button class="btn" onclick="start('Mobility')">FLOW</button>
        </div>
    </div>

    <div id="workout" class="screen">
        <div class="header">
            <span class="nav-icon" onclick="nav('home')">‚¨ÖÔ∏è</span>
            <h3 id="w-title" style="font-size: 16px;">WORKOUT</h3>
            <span style="width: 24px;"></span>
        </div>
        <div style="background: #222; height: 4px; width: 100%; border-radius: 2px; margin-bottom: 20px;">
            <div id="w-progress" style="background: var(--primary); height: 100%; width: 0%; transition: 0.3s;"></div>
        </div>

        <div class="card" style="text-align: center; padding: 40px 20px;">
            <div id="ex-icon" style="font-size: 60px; margin-bottom: 20px;">üèãÔ∏è</div>
            <h2 id="ex-name" style="font-size: 24px; margin-bottom: 10px;">NAME</h2>
            <div style="height: 1px; background: #333; margin: 15px 0;"></div>
            <div class="text-primary" style="font-weight: bold; font-size: 18px; color: var(--primary);" id="ex-target">3x5</div>
            <div style="color: var(--dim); margin-top: 5px; font-size: 14px;" id="ex-hist">Last: -</div>
            <div style="color: orange; font-style: italic; margin-top: 15px;" id="ex-cue">"Cue"</div>
        </div>

        <div class="grid">
            <input type="number" id="in-weight" placeholder="Weight (kg)">
            <input type="number" id="in-reps" placeholder="Reps">
        </div>

        <div id="timer" style="text-align: center; font-size: 28px; font-weight: bold; color: #ff5555; margin: 15px 0; height: 35px;"></div>
        <button class="btn btn-primary" onclick="nextEx()">LOG SET & REST</button>
    </div>

    <div id="guide" class="screen">
        <div class="header"><span class="nav-icon" onclick="nav('home')">‚¨ÖÔ∏è</span><h3>BLACK BOOK</h3><span></span></div>
        <div id="guide-content"></div>
    </div>

    <div id="tools" class="screen">
        <div class="header"><span class="nav-icon" onclick="nav('home')">‚¨ÖÔ∏è</span><h3>TOOLS</h3><span></span></div>
        <div class="card">
            <h3>PLATE CALCULATOR</h3>
            <input type="number" id="plate-in" placeholder="Target Weight (kg)">
            <button class="btn btn-primary" onclick="calcPlate()">CALCULATE</button>
            <div id="plate-out" style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 18px; color: var(--primary);">Load: -</div>
        </div>
    </div>

<script>
// ================= DATABASE WITH VARIATIONS =================
// Structure: Single object {n:name, r:reps...} OR Pool object {pool: [{...}, {...}]}
const DB = {
    "Upper Power": [
        {n:"Bench Press",r:"3x5",c:"Leg Drive",i:"üí™"},
        {n:"Bent Rows",r:"3x5",c:"Explode",i:"üö£"},
        {n:"OHP",r:"3x6",c:"Head Thru",i:"üôå"},
        {pool:[{n:"Weighted Pullups",r:"3x6",c:"Chin Over",i:"üßó"}, {n:"Lat Pulldown",r:"3x10",c:"Squeeze",i:"‚¨áÔ∏è"}]},
        {pool:[{n:"Skullcrushers",r:"3x10",c:"Elbows In",i:"üí™"}, {n:"Barbell Curl",r:"3x10",c:"Strict",i:"üí™"}]}
    ],
    "Lower Power": [
        {n:"Squat",r:"3x5",c:"Break Parallel",i:"ü¶µ"},
        {n:"Deadlift",r:"3x5",c:"Push Floor",i:"üèãÔ∏è"},
        {pool:[{n:"Leg Press",r:"3x10",c:"Full Depth",i:"ü¶µ"}, {n:"Hack Squat",r:"3x8",c:"Deep",i:"ü¶µ"}]},
        {pool:[{n:"Leg Curl",r:"3x12",c:"Hips Down",i:"ü¶µ"}, {n:"RDL",r:"3x10",c:"Stretch",i:"üßò"}]}
    ],
    "Push Hyper": [
        {n:"Inc DB Press",r:"3x10",c:"Upper Chest",i:"‚ÜóÔ∏è"},
        {n:"Seated Press",r:"3x12",c:"Shoulders",i:"üôå"},
        {pool:[{n:"Cable Fly",r:"3x15",c:"Squeeze",i:"üëê"}, {n:"Pec Deck",r:"3x15",c:"Elbows Up",i:"üëê"}]},
        {pool:[{n:"Lat Raise",r:"4x15",c:"Width",i:"ü¶Ö"}, {n:"Upright Row",r:"3x12",c:"Side Delts",i:"‚¨ÜÔ∏è"}]},
        {pool:[{n:"Pushdown",r:"3x15",c:"Lockout",i:"‚¨áÔ∏è"}, {n:"Dips",r:"Failure",c:"Lean",i:"üí™"}]}
    ],
    "Pull Hyper": [
        {n:"BB Rows",r:"4x10",c:"Volume",i:"üö£"},
        {n:"Lat Pulldown",r:"3x12",c:"Control",i:"‚¨áÔ∏è"},
        {pool:[{n:"Face Pulls",r:"4x15",c:"Rear Delt",i:"üëÄ"}, {n:"Rear Flys",r:"3x15",c:"Pinkies Out",i:"ü¶Ö"}]},
        {pool:[{n:"Hammer Curl",r:"3x12",c:"Forearms",i:"üî®"}, {n:"Preacher Curl",r:"3x12",c:"Peak",i:"üí™"}]}
    ],
    "Legs Hyper": [
        {n:"Front Squat",r:"3x10",c:"Upright",i:"ü¶µ"},
        {n:"Lunges",r:"3x20",c:"Knee Touch",i:"üö∂"},
        {pool:[{n:"Leg Ext",r:"3x15",c:"Burn",i:"ü¶µ"}, {n:"Goblet Squat",r:"3x12",c:"Depth",i:"üç∑"}]},
        {n:"Calf Raise",r:"4x15",c:"Pause",i:"‚¨ÜÔ∏è"}
    ],
    
    // SPECIALTY (Fixed Lists)
    "Chest Focus": [{n:"Bench",r:"4x8",i:"üí™"},{n:"Inc DB",r:"3x10",i:"‚ÜóÔ∏è"},{n:"Dips",r:"3xFail",i:"üí™"},{n:"Fly",r:"3x15",i:"üëê"},{n:"Pushups",r:"2xFail",i:"‚¨áÔ∏è"}],
    "Back Focus": [{n:"Deadlift",r:"3x5",i:"üèãÔ∏è"},{n:"Pullups",r:"3xFail",i:"üßó"},{n:"T-Bar",r:"3x10",i:"üö£"},{n:"Pulldown",r:"3x15",i:"‚¨áÔ∏è"}],
    "Shoulder Focus": [{n:"OHP",r:"4x8",i:"üôå"},{n:"Arnold",r:"3x12",i:"üí™"},{n:"Lat Raise",r:"5x15",i:"ü¶Ö"},{n:"Face Pull",r:"3x15",i:"üëÄ"}],
    "Leg Focus": [{n:"Squat",r:"4x8",i:"ü¶µ"},{n:"Leg Press",r:"3x12",i:"ü¶µ"},{n:"Lunges",r:"3x20",i:"üö∂"},{n:"Leg Curl",r:"3x15",i:"ü¶µ"}],
    "Bicep Blaster": [{n:"BB Curl",r:"4x8",i:"üí™"},{n:"Inc Curl",r:"3x10",i:"üí™"},{n:"Hammer",r:"3x12",i:"üî®"},{n:"21s",r:"2 Sets",i:"‚ö°"}],
    "Tricep Torture": [{n:"C.G. Bench",r:"4x8",i:"üí™"},{n:"Skullcrush",r:"3x10",i:"üíÄ"},{n:"Pushdown",r:"3x15",i:"‚¨áÔ∏è"},{n:"Dips",r:"Fail",i:"üí™"}],

    // CONDITIONING
    "HIIT": [{n:"Burpees",r:"45s",i:"üî•"},{n:"Box Jumps",r:"45s",i:"üì¶"},{n:"Climbers",r:"45s",i:"üßó"}],
    "Tabata": [{n:"Sprints",r:"20s/10s",i:"üèÉ"},{n:"Swings",r:"20s/10s",i:"üîî"}],
    "EMOM": [{n:"Thrusters",r:"10/min",i:"üèãÔ∏è"},{n:"Pullups",r:"5/min",i:"üßó"}],
    "Animal Flow": [{n:"Beast Crawl",r:"60s",i:"üêæ"},{n:"Crab Walk",r:"60s",i:"ü¶Ä"},{n:"Scorpion Reach",r:"10/side",i:"ü¶Ç"},{n:"Ape Hops",r:"60s",i:"ü¶ç"}],

    // RECOVERY
    "Desk Undo": [{n:"Chin Tucks",r:"20",i:"üôÇ"},{n:"Doorway Stretch",r:"60s",i:"üö™"},{n:"Thoracic Ext",r:"60s",i:"üßò"}],
    "Squat Primer": [{n:"90/90",r:"60s",i:"üßò"},{n:"Ankle Rocks",r:"20",i:"ü¶∂"},{n:"Goblet Hold",r:"60s",i:"üç∑"}],
    "Mobility": [{n:"Cat Cow",r:"60s",i:"üêà"},{n:"90/90",r:"60s",i:"üßò"},{n:"Deep Squat",r:"60s",i:"ü¶µ"}]
};

const WARMUPS = [{n:"Arm Circles",r:"30s",c:"Dynamic",i:"üîÑ"},{n:"Band Pulls",r:"20 Reps",c:"Rear Delts",i:"‚ÜîÔ∏è"}];
const COOLDOWN = {n:"Childs Pose",r:"60s",c:"Relax Spine",i:"üë∂"};

const GUIDES = [
    {t:"1. Iron Philosophy", s:"POWER + HYPERTROPHY", b:"Days 1-2: Power (3-5 Reps). Density.\nDays 4-6: Hypertrophy (8-15). Size.\nHeavy lifting builds engine. Volume builds fuel tank."},
    {t:"2. RAMP Warmup", s:"DON'T STRETCH COLD", b:"R: Raise (Sweat)\nA: Activate (Glutes)\nM: Mobilize (Dynamic)\nP: Potentiate (Warmup sets)"},
    {t:"3. The Big 3", s:"TECHNIQUE", b:"SQUAT: Break bar across traps.\nBENCH: Leg drive back.\nDEADLIFT: Push floor away."},
    {t:"4. Overload", s:"DO MORE", b:"1. Intensity (+2.5kg)\n2. Volume (+1 Rep)\n3. Density (Less Rest)\n4. Form (Slower)"},
    {t:"5. Nutrition", s:"FUEL", b:"Surplus = Growth. Deficit = Cut.\nProtein: 1g/lb.\nSleep: 8 Hours."},
    {t:"6. CNS Fatigue", s:"RECOVERY", b:"Weak grip? No motivation? You're fried. Take a deload week."},
    {t:"7. Equipment", s:"TOOLS", b:"Barbell: Mass\nDumbbell: Balance\nCable: Isolation\nMachine: Safety"},
    {t:"8. Injury", s:"STAY SAFE", b:"Good Pain: Dull ache (DOMS)\nBad Pain: Sharp/Joint\nFix: Form > Weight"}
];

// ================= APP LOGIC =================
let playlist = [];
let pIndex = 0;
let timer = null;

function nav(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'guide') loadGuide();
}

function start(mode) {
    playlist = [];
    
    // 1. Add Warmup
    if(!["Mobility","HIIT","Tabata","EMOM","Desk Undo","Squat Primer","Animal Flow"].includes(mode)) {
        WARMUPS.forEach(w => playlist.push({...w, h:"-"}));
    }

    // 2. Build Workout (Handle Pools)
    if(DB[mode]) {
        DB[mode].forEach(slot => {
            let ex;
            if(slot.pool) {
                // RANDOM VARIATION LOGIC HERE
                ex = slot.pool[Math.floor(Math.random() * slot.pool.length)];
            } else {
                ex = slot;
            }
            let hist = localStorage.getItem("last_"+ex.n) || "New Exercise";
            // Safety defaults
            ex.c = ex.c || "Focus"; 
            ex.i = ex.i || "üèãÔ∏è";
            playlist.push({...ex, h: hist});
        });
    }

    // 3. Add Cooldown
    if(!["Mobility","HIIT","Tabata","EMOM","Desk Undo","Squat Primer","Animal Flow"].includes(mode)) {
        playlist.push({...COOLDOWN, h:"-"});
    }
    
    pIndex = 0;
    document.getElementById('w-title').innerText = mode;
    showEx();
    nav('workout');
}

function showEx() {
    if(pIndex >= playlist.length) { alert("WORKOUT COMPLETE!"); nav('home'); return; }
    let ex = playlist[pIndex];
    
    document.getElementById('ex-name').innerText = ex.n;
    document.getElementById('ex-icon').innerText = ex.i;
    document.getElementById('ex-target').innerText = "TARGET: " + ex.r;
    document.getElementById('ex-hist').innerText = ex.h.includes("New") ? ex.h : "Last: " + ex.h;
    document.getElementById('ex-cue').innerText = '"' + ex.c + '"';
    
    document.getElementById('in-weight').value = "";
    document.getElementById('in-reps').value = "";
    document.getElementById('w-progress').style.width = ((pIndex / playlist.length)*100) + "%";
    
    if(timer) clearInterval(timer);
    document.getElementById('timer').innerText = "";
}

function nextEx() {
    let ex = playlist[pIndex];
    let w = document.getElementById('in-weight').value;
    let r = document.getElementById('in-reps').value;
    
    if(w && r) {
        localStorage.setItem("last_"+ex.n, w+"kg x "+r);
    }
    
    // Timer Logic
    let sec = 90;
    if(document.getElementById('w-title').innerText === 'HIIT') sec = 15;
    if(document.getElementById('w-title').innerText === 'Tabata') sec = 10;

    document.getElementById('timer').innerText = "REST: " + fmt(sec);
    if(timer) clearInterval(timer);
    
    timer = setInterval(() => {
        sec--;
        document.getElementById('timer').innerText = "REST: " + fmt(sec);
        if(sec<=0) { clearInterval(timer); document.getElementById('timer').innerText = "GO!"; }
    }, 1000);

    pIndex++;
    if(pIndex < playlist.length) {
        // Delay to allow user to see button press
        setTimeout(showEx, 250);
    } else {
        setTimeout(() => {alert("WORKOUT COMPLETE!"); nav('home');}, 500);
    }
}

function fmt(s) { return (s-(s%=60))/60+(9<s?':':':0')+s; }

// ================= TOOLS & GUIDE =================
function loadGuide() {
    const box = document.getElementById('guide-content');
    box.innerHTML = "";
    GUIDES.forEach(g => {
        let d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<div class="text-primary" style="font-weight:bold">${g.t}</div><div style="font-size:12px; color:orange; margin:5px 0">${g.s}</div><div style="white-space:pre-line; color:#ddd; font-size:14px">${g.b}</div>`;
        box.appendChild(d);
    });
}

function calcPlate() {
    let w = parseFloat(document.getElementById('plate-in').value);
    if(!w || w < 20) { document.getElementById('plate-out').innerText = "Bar Only"; return; }
    let rem = (w - 20) / 2;
    let plates = [25, 20, 15, 10, 5, 2.5, 1.25];
    let load = [];
    for(let p of plates) {
        while(rem >= p) { load.push(p); rem -= p; }
    }
    document.getElementById('plate-out').innerText = "Side: " + (load.length ? load.join(', ') : "Bar Only");
}
</script>
</body>
</html>
